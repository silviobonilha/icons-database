<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Relatórios</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.14.0/Sortable.min.js"></script>
</head>

<body class="bg-gray-100">

     <!-- configuração cabeçalho -->
    <!--script src="script.js"></script -->
    <script src="header.js"></script>
    
    <custom-header></custom-header>
    <custom-header></custom-header>
    
    <main class="container mx-auto px-4 py-8">
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-4">Editor de Relatórios</h1>
            
            <div class="flex flex-col md:flex-row gap-6">
                <!-- Left sidebar with lesson list -->
                <div class="w-full md:w-1/3 bg-gray-50 p-4 rounded-lg">
                    <div class="flex justify-between items-center mb-4">
                        <h3class="text-lg font-semibold">Clique para nova turma </h3>
                        <button id="add-lesson" class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700">
                            + Adicionar
                        </button>
                    </div>
                    
                    <div id="lesson-list" class="space-y-2">
                        <!-- Lessons will be loaded here -->
                    </div>
                </div>
                <!-- Right content with editor -->
                <div class="w-full md:w-2/3">
                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
<div class="mb-4">
                            <label class="block text-gray-700 mb-2">ID da Aula</label>
                            <input type="text" id="lesson-id" class="w-full p-2 border border-gray-300 rounded" readonly>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 mb-2">Unidade / Turma</label>
                            <input type="text" id="lesson-title" class="w-full p-2 border border-gray-300 rounded">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-gray-700 mb-2">Conteúdo</label>
                            <textarea id="lesson-content" class="w-full p-2 border border-gray-300 rounded h-64"></textarea>
                        </div>
                        
                        <div class="flex justify-end space-x-3">
                            <button id="delete-lesson" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                                Excluir
                            </button>
                            <button id="save-lesson" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                                Salvar <span id="last-saved" class="text-xs ml-1"></span>
                            </button>
</div>
                    </div>
                    <div class="mt-4 bg-red-50 border border-gray-200 rounded-lg p-4">
<h2 class="text-lg font-semibold mb-3">Exportar/Importar Dados</h2>
                        <div class="flex flex-col md:flex-row gap-3">
                            <button id="export-json" class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700">
                                Exportar JSON
                            </button>
                            <button id="import-json" class="bg-purple-600 text-white px-3 py-1 rounded hover:bg-purple-700">
                                Importar JSON
                            </button>
                            <input type="file" id="json-file" class="hidden" accept=".json">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="components/header.js"></script>
    <script src="script.js"></script>
    <style>
        #save-lesson {
            transition: background-color 0.3s ease;
        }
        #last-saved {
            opacity: 0.8;
            font-weight: normal;
        }
    </style>
<script>
        // Load data from localStorage or use default
        let lessonsData = JSON.parse(localStorage.getItem('lessonsData')) || [];
// DOM elements
        const lessonList = document.getElementById('lesson-list');
        const lessonId = document.getElementById('lesson-id');
        const lessonTitle = document.getElementById('lesson-title');
        const lessonContent = document.getElementById('lesson-content');
        const saveButton = document.getElementById('save-lesson');
        const deleteButton = document.getElementById('delete-lesson');
        const addButton = document.getElementById('add-lesson');
        const exportButton = document.getElementById('export-json');
        const importButton = document.getElementById('import-json');
        const fileInput = document.getElementById('json-file');

        // Current selected lesson
        let currentLesson = null;
        // Save data to localStorage
        function saveToLocalStorage() {
            localStorage.setItem('lessonsData', JSON.stringify(lessonsData));
        }

        // Initialize the editor
        function initEditor() {
            // Load any saved data from localStorage
            const savedData = localStorage.getItem('lessonsData');
            if (savedData) {
                try {
                    lessonsData = JSON.parse(savedData);
                } catch (e) {
                    console.error('Error parsing saved data:', e);
                    lessonsData = [];
                }
            }
            renderLessonList();
            saveToLocalStorage();
saveToLocalStorage();
saveToLocalStorage();
saveToLocalStorage();
// Set up event listeners
            saveButton.addEventListener('click', saveLesson);
            deleteButton.addEventListener('click', deleteLesson);
            addButton.addEventListener('click', addNewLesson);
            exportButton.addEventListener('click', exportJSON);
            importButton.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', importJSON);
            
            // Initialize sortable
            new Sortable(lessonList, {
                animation: 150,
                onEnd: function() {
                    // Reorder lessons based on new position
                    const items = lessonList.querySelectorAll('.lesson-item');
                    const newOrder = Array.from(items).map(item => 
                        lessonsData.find(lesson => lesson.id === parseInt(item.dataset.id))
                    );
            lessonsData = newOrder;
            saveToLocalStorage();
}
            });
        }

        // Render the lesson list
        function renderLessonList() {
            lessonList.innerHTML = '';
            lessonsData.forEach(lesson => {
                const title = lesson.text.split('\n')[0].replace('Aula:', '').trim();
                const item = document.createElement('div');
                item.className = 'lesson-item p-3 bg-gray-100 hover:bg-gray-200 rounded cursor-pointer';
                item.dataset.id = lesson.id;
                item.innerHTML = `
                    <div class="font-medium">${title || 'Sem título'}</div>
                    <div class="text-sm text-gray-500 truncate">${lesson.text.substring(0, 60)}...</div>
                `;
                item.addEventListener('click', () => loadLesson(lesson));
                lessonList.appendChild(item);
            });
        }

        // Load a lesson into the editor
        function loadLesson(lesson) {
            currentLesson = lesson;
            lessonId.value = lesson.id;
            
            // Extract title (first line) and content (rest)
            const lines = lesson.text.split('\n');
            const title = lines[0].startsWith('Aula:') ? lines[0].substring(5).trim() : lines[0].trim();
            const content = lines.slice(1).join('\n').trim();
            
            lessonTitle.value = title;
            lessonContent.value = content;
        }
        // Save the current lesson
        function saveLesson() {
            if (!currentLesson) return;
            
            // Update lesson data
            const title = lessonTitle.value.trim();
            const content = lessonContent.value.trim();
            currentLesson.text = `Aula: ${title}\n${content}`;
            
            renderLessonList();
            
            // Update last saved timestamp
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            document.getElementById('last-saved').textContent = `(último: ${timeString})`;
            
            // Flash the save button to indicate save happened
            const saveBtn = document.getElementById('save-lesson');
            saveBtn.classList.add('bg-green-500');
            setTimeout(() => saveBtn.classList.remove('bg-green-500'), 300);
        }
// Delete the current lesson
        function deleteLesson() {
            if (!currentLesson) return;
            
            if (confirm('Tem certeza que deseja excluir esta aula?')) {
                lessonsData = lessonsData.filter(lesson => lesson.id !== currentLesson.id);
                currentLesson = null;
                clearEditor();
                renderLessonList();
            }
        }

        // Add a new lesson
        function addNewLesson() {
            const newId = lessonsData.length > 0 ? Math.max(...lessonsData.map(l => l.id)) + 1 : 1;
            const newLesson = {
                id: newId,
                text: `Aula: Nova Aula\n\nDigite seu conteúdo aqui...`
            };
            
            lessonsData.push(newLesson);
            renderLessonList();
            loadLesson(newLesson);
        }

        // Clear the editor
        function clearEditor() {
            lessonId.value = '';
            lessonTitle.value = '';
            lessonContent.value = '';
        }

        // Export JSON data
        function exportJSON() {
            const dataStr = JSON.stringify(lessonsData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'aulas-biblia.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // Import JSON data
        function importJSON(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const jsonData = JSON.parse(e.target.result);
                    if (Array.isArray(jsonData)) {
                    lessonsData = jsonData;
                    saveToLocalStorage();
                    renderLessonList();
alert('Dados importados com sucesso!');
                    } else {
                        alert('O arquivo não contém um array de aulas válido.');
                    }
                } catch (error) {
                    alert('Erro ao ler o arquivo JSON: ' + error.message);
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            event.target.value = '';
        }
        // Auto-save every 2 minutes
        function setupAutoSave() {
            setInterval(() => {
                if (currentLesson) {
                    saveLesson();
                    console.log('Auto-saved lesson:', currentLesson.id);
                }
                // Also save all data to localStorage periodically
                saveToLocalStorage();
            }, 120000); // 2 minutes in milliseconds
        }
// Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            initEditor();
            setupAutoSave();
        });
</script>
</body>
</html>
